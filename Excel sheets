import os
import pandas as pd

# Paths
source_folder = 'path/to/source/folder'
destination_folder = 'path/to/destination/folder'

# Create destination folder if it doesn't exist
os.makedirs(destination_folder, exist_ok=True)

# File types to convert
allowed_extensions = ('.xlsx', '.xlsm', '.xlm')

# Loop through source folder
for filename in os.listdir(source_folder):
    if filename.lower().endswith(allowed_extensions):
        source_path = os.path.join(source_folder, filename)
        base_name = os.path.splitext(filename)[0]
        new_filename = base_name + '.xlsx'
        destination_path = os.path.join(destination_folder, new_filename)

        try:
            # Read all sheets into a dictionary of DataFrames
            excel_data = pd.read_excel(source_path, sheet_name=None, engine='openpyxl' if filename.endswith('.xlsx') else None)

            # Write all sheets to new .xlsx file
            with pd.ExcelWriter(destination_path, engine='openpyxl') as writer:
                for sheet_name, df in excel_data.items():
                    df.to_excel(writer, sheet_name=sheet_name, index=False)

            print(f"✅ Converted and saved: {new_filename}")

        except Exception as e:
            print(f"❌ Error processing {filename}: {e}")
